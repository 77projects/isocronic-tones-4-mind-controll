<!DOCTYPE html>
<html>
<head>
  <title>Isochronic Tone Generator</title>
  </head>
<body>
  <h1>Isochronic Tone Generator</h1>
  <div class="controls">
    <button id="record-button">Record Voice</button>
    </div>
  <p id="frequency-display">Frequency:</p>
  <audio id="audio-player"></audio>
  <script>
    const carrierFrequencyInput = document.getElementById('carrier-frequency');
    const thetaFrequencyInput = document.getElementById('theta-frequency');
    const recordButton = document.getElementById('record-button');
    const frequencyDisplay = document.getElementById('frequency-display');
    const audioPlayer = document.getElementById('audio-player');

    let audioContext;
    let mediaRecorder;

    function detectVoiceFrequency(audioData) {
      const analyser = new AnalyserNode(audioContext);
      analyser.fftSize = 2048;

      audioData.connect(analyser);

      const frequencyData = new Uint8Array(analyser.frequencyBinCount);
      analyser.getByteFrequencyData(frequencyData);

      let maxFrequency = 0;
      let maxIndex = 0;
      for (let i = 0; i < frequencyData.length; i++) {
        if (frequencyData[i] > maxFrequency) {
          maxFrequency = frequencyData[i];
          maxIndex = i;
        }
      }

      return (maxIndex / analyser.frequencyBinCount) * audioContext.sampleRate;
    }

    recordButton.addEventListener('click', () => {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          const microphone = audioContext.createMediaStreamSource(stream);
          const chunks = [];

          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.start();

          mediaRecorder.ondataavailable = (event) => {
            chunks.push(event.data);
          };

          mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { 'type': 'audio/ogg; codecs=opus' });
            const audioURL = URL.createObjectURL(blob);

            // Analyze the recorded audio
            const audioSource = audioContext.createMediaElementSource(new Audio(audioURL));
            const dominantFrequency = detectVoiceFrequency(audioSource);

            // Update the frequency display
            frequencyDisplay.textContent = `Frequency: ${dominantFrequency.toFixed(2)} Hz`;

            // Play the recorded audio (optional)
            audioPlayer.src = audioURL;
            audioPlayer.play();
          };

          setTimeout(() => {
            mediaRecorder.stop();
          }, 5000); // Adjust recording duration as needed
        })
        .catch(error => {
          console.error('Error accessing microphone:', error);
        });
    });

    // Play button and stop button logic remains the same (if you want to keep the isochronic tone generation functionality)
    // Download button logic can be modified to download the recorded audio if needed.
  </script>
</body>
</html>
